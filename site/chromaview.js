!function(t){var e={};function o(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=t,o.c=e,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=0)}([function(t,e,o){"use strict";o.r(e);const n={NORMAL:0,PROTANOPIA:1,PROTANOMALY:2,DEUTERANOPIA:3,DEUTERANOMALY:4,TRITANOPIA:5,TRITANOMALY:6,ACHROMATOPSIA:7,ACHROMATOMALY:8},r=["normal.lut.png","protanopia.lut.png","protanomaly.lut.png","deuteranopia.lut.png","deuteranomaly.lut.png","tritanopia.lut.png","tritanomaly.lut.png","achromatopsia.lut.png","achromatomaly.lut.png"],i=[],a=[];function l(t=n.NORMAL){this.perf=0,this.setMode(t)}l.prototype.setMode=function(t){this.model=t},l.prototype.load=function(t,e=!1){function o(){if(e){if(9==i.length){for(let t of i)if(!t)return;t(!0)}}else t(!0)}if(e)for(const t in n)console.log("Loading lut",t),this.loadLUT(r[n[t]],n[t],o.bind(this));else this.loadLUT(r[this.model],this.model,o.bind(this))},l.prototype.process=function(t,e){const o=performance.now(),n=l.toLUTCoord(t.data[4*e],t.data[4*e+1],t.data[4*e+2]);t.data[4*e]=i[this.model][n],t.data[4*e+1]=i[this.model][n+1],t.data[4*e+2]=i[this.model][n+2],this.perf=performance.now()-o},l.prototype.processData=function(t){if(this.curModel){const e=l.toLUTCoord(t[0],t[1],t[2]);return[this.curModel[e],this.curModel[e+1],this.curModel[e+2]]}return t},l.toLUTCoord=function(t,e,o){t=Math.floor(t/4),e=Math.floor(e/4);let n=(o=Math.floor(o/4))%8*64+t;return 4*(512*(64*Math.floor(o/8)+e)+n)},l.prototype.loadLUT=function(t,e,o){a[e]=new Image,a[e].onload=function(){const t=document.createElement("canvas");t.width=this.width,t.height=this.height;const n=t.getContext("2d");n.drawImage(this,0,0);const r=n.getImageData(0,0,this.width,this.height);i[e]=r.data,o()},a[e].setAttribute("crossOrigin","anonymous"),a[e].src=t};var c,d,u,s,f,g,h,p=l;navigator.mediaDevices||alert("Browser does not support HTML5 MediaDevices!");const m=new p(n.NORMAL);var y=0;function A(t){0==y&&(y=t),function(){f.drawImage(u,0,0);const t=f.getImageData(0,0,c,d),e=t.data.length/4;for(let o=0;o<e;o++)m.process(t,o);h.putImageData(t,0,0)}();const e=t-y;y=t,h.font="12px sans-serif",h.fillStyle="rgba(255,255,255,0.5)",h.fillText(`${Math.round(1e3/e)}FPS - Î”${e.toFixed(1)} - ${m.perf.toFixed(2)}`,2,d-2),window.requestAnimationFrame(A)}function O(t){u.play(),window.requestAnimationFrame(A)}function v(){navigator.mediaDevices.getUserMedia({audio:!1,video:{width:{ideal:1080,max:1920},height:{ideal:720,max:1080},facingMode:"environment"}}).then(t=>{console.log("Got camera media, binding to video");const e=t.getVideoTracks()[0];if(e){const o=e.getSettings();console.log("Video settings: ",o),c=o.width,d=o.height,u.width=o.width,u.height=o.height,u.srcObject=t,(s=document.createElement("canvas")).width=c,s.height=d,f=s.getContext("2d"),(g=document.getElementById("render-target")).width=c,g.height=d,h=g.getContext("2d"),m.load(O,!0)}}).catch(t=>{console.error("Error getting camera media: ",t)})}u=document.getElementById("video-plr"),document.getElementById("modesel").addEventListener("change",function(t){const e=t.target.value;m.setMode(n[e]),console.log("Changed",e)}),v()}]);